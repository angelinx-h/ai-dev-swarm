# Stage 08 - DevOps

Set up the complete DevOps infrastructure including GitHub repositories, CI/CD pipelines, containerization, cloud infrastructure (AWS, RunPod), and monitoring to enable seamless development and deployment workflows.

## Instructions

### 1. Context Review

Read all the files below to understand the design of this project so far:

- `ideas.md`
- `00-init-ideas/` - All markdown files
- `01-market-research/` - All markdown files
- `02-personas/` - All markdown files
- `03-mvp/` - All markdown files
- `04-prd/` - All markdown files
- `05-ux/` - All markdown files
- `06-architecture/` - All markdown files
- `07-tech-specs/` - All markdown files

### 2. Create Stage Proposal

Create the file `08-devops/README.md` with the following content:

#### 2.1 Stage Goal

Brief the goal of this stage in 2-3 paragraphs:
- What this stage aims to achieve (infrastructure setup, CI/CD automation, deployment readiness)
- Why DevOps setup is critical for development velocity and production reliability
- How this stage builds upon architecture and tech-specs to create executable infrastructure
- What deliverables will be produced (working pipelines, configured services, documentation)

#### 2.2 File Selection

Pick and list the file names from the options below that are most suitable for this project:

**DevOps Strategy & Overview:**
- `devops-overview.md` - DevOps strategy overview including branching strategy, environment promotion, and release management
- `environment-config.md` - Environment configurations for dev, staging, and production
- `execution-plan.md` - Checklist of infrastructure tasks split into Stage 08 (dev setup) and Stage 10 (production deployment)

**Repository & Version Control:**
- `github-setup.md` - GitHub repository setup including branch protection rules, PR templates, and team permissions
- `ssh-access-policy.md` - How SSH keys are generated and managed for EC2/GitHub

**CI/CD Pipeline:**
- `ci-cd-pipeline.md` - CI/CD pipeline design including stages, triggers, and deployment gates
- `ci-workflow.yml` - GitHub Actions CI workflow for build, test, and validation
- `cd-workflow.yml` - GitHub Actions CD workflow for automated deployment

**Containerization:**
- `docker_strategy.md` - Plan for Dockerfile and docker-compose.yml (Dev vs. Prod configurations)

**Cloud Infrastructure - AWS:**
- `aws-setup.md` - AWS account & services setup including IAM, VPC, and security groups
- `ec2-setup.md` - EC2 instance configuration including instance types, AMIs, and networking
- `s3-setup.md` - S3 bucket configuration for static assets, backups, and file storage

**Web Server & Database:**
- `nginx-setup.md` - Nginx configuration documentation
- `nginx.conf` - Nginx config file for reverse proxy and load balancing
- `mysql-setup.md` - MySQL setup documentation including schema deployment and backup strategy

**GPU Infrastructure:**
- `runpod-setup.md` - RunPod GPU setup for AI/ML workloads

**Infrastructure as Code:**
- `infrastructure/terraform/main.tf` - Main Terraform configuration
- `infrastructure/terraform/variables.tf` - Terraform input variables
- `infrastructure/terraform/outputs.tf` - Terraform output definitions

**Monitoring & Security:**
- `monitoring-setup.md` - Monitoring & logging setup including CloudWatch, alerts, and dashboards
- `secrets-management.md` - Env vars, vault approach, Secrets management strategy

**Mobile App Store Setup (if applicable):**
- `app-store-setup.md` - Apple App Store Connect setup (developer account, app registration, certificates)
- `google-play-setup.md` - Google Play Console setup (developer account, app registration, signing)
- `mobile-signing-setup.md` - Code signing certificates, provisioning profiles (iOS), keystores (Android)

For each selected file, provide:
- Short description of what the file contains
- Why it's essential for this specific project
- What key configuration it should include

**Note:** Select files based on project requirements. Not all files may be necessary for every project. Consider:
- Whether the project requires GPU infrastructure (RunPod)
- The complexity of the deployment (single server vs. distributed)
- Security and compliance requirements

#### 2.3 Request User Approval

Present the stage plan to the user and ask - Please check the Stage Proposal file in file `08-devops/README.md`, and update it directly or tell me how to update it

### 3. Create Documentation

Once the user updates & approves the plan in `08-devops/README.md`, read the file and understand user's update for the next step:

#### 3.1 Create All Planned Files

Create each file listed in the approved README.md within the `08-devops/` folder:

- **For `.md` files:** Write comprehensive, well-structured documentation with step-by-step instructions
- **For `.yml` files:** Create working GitHub Actions workflow files with proper syntax and comments
- **For `.conf` files:** Create production-ready configuration files with inline comments
- **For `.tf` files:** Create valid Terraform configurations following best practices

**Quality Guidelines:**
- Base configurations on architecture decisions from previous stages
- Include security best practices in all infrastructure setup
- Document all environment variables and secrets required
- Provide both development and production configurations where applicable
- Include rollback procedures for each deployment step
- Reference specific tech stack choices from `07-tech-specs/`
- Ensure CI/CD pipelines include proper testing stages
- Document estimated costs for cloud resources

#### 3.2 Request User Approval for Files

After creating all files, present them to the user:
- Provide a summary of what was created
- Highlight key infrastructure decisions
- List any credentials or access needed for later execution
- Ask: "Please review the DevOps setup files. You can update or delete the files or let me know how to do it"

#### 3.3 Revise Based on Feedback

If the user requests changes:
- Update the files according to user feedback
- Re-present the updated files for approval
- Repeat until user approves all documentation

### 4. Finalize Documentation

Once the user approves all files, finalize the documentation:

#### 4.1 Documentation Finalization
- Sync with `08-devops/README.md`, to remove any deleted files which the user doesn't want to have
- Ensure all files are complete and well-formatted
- Verify that DevOps setup aligns with architecture design
- Confirm all setup steps are documented with prerequisites
- Validate all configuration file syntax (YAML, Terraform, Nginx)
- Check that all diagrams render correctly (if any)

#### 4.2 Announce Documentation Complete
Inform the user:
- "DevOps documentation is complete and ready for execution"
- Summary of files created
- List of infrastructure to be provisioned

### 5. Create Execution Plan

Create `08-devops/execution-plan.md` to let user decide what to execute now vs later:

#### 5.1 Execution Plan Structure

The execution plan file should have two sections:

**Part 1: Execute in Stage 08 (Development Setup)**
Items typically executed now for development workflow:
- [ ] GitHub repository setup (create repos, branch protection, PR templates)
- [ ] SSH key generation and configuration
- [ ] Local Docker development environment (Dockerfile, docker-compose.yml)
- [ ] CI pipeline setup (build, test, lint on PR)
- [ ] Local database setup (MySQL in Docker)
- [ ] Development environment configuration

**Part 2: Execute in Stage 10 (Production Deployment)**
Items that can be deferred until product is ready for production:
- [ ] AWS account & IAM setup
- [ ] EC2 instance provisioning
- [ ] Production S3 bucket creation
- [ ] Production database setup (RDS or EC2 MySQL)
- [ ] Nginx reverse proxy configuration
- [ ] SSL certificate setup
- [ ] CD pipeline activation (deploy to production)
- [ ] RunPod GPU setup (if applicable)
- [ ] Monitoring & alerting configuration
- [ ] Domain & DNS configuration

**Part 3: Mobile App Store Setup (if applicable)**
Items for mobile app projects - can be done in Stage 08 or deferred to Stage 10:
- [ ] Apple Developer account setup ($99/year)
- [ ] App Store Connect app registration
- [ ] iOS certificates and provisioning profiles
- [ ] Google Play Developer account setup ($25 one-time)
- [ ] Google Play Console app registration
- [ ] Android keystore generation and management
- [ ] Fastlane setup for automated builds and deployment

For each item, include:
- Description of what will be created/configured
- Prerequisites (credentials, access, dependencies)
- Estimated costs (for cloud resources)
- Reversibility (can it be undone easily?)

#### 5.2 Execution Strategy Options

Present two common strategies to user:

**Option A: Local-First Development**
- Execute only Part 1 (Stage 08) items now
- Develop and test locally using Docker
- Defer all cloud infrastructure to Stage 10
- Best for: New projects, cost-sensitive development, uncertain requirements

**Option B: Cloud-Ready Development**
- Execute Part 1 (Stage 08) items now
- Also execute some Part 2 items now (e.g., AWS setup, staging environment)
- Enable continuous deployment to staging from the start
- Best for: Team collaboration, client demos, integration testing with cloud services

#### 5.3 Request User Decision

Ask user to:
1. Review `08-devops/execution-plan.md`
2. Check/uncheck items they want to execute now
3. Choose their execution strategy (Option A or B, or custom)
4. Provide any required credentials for checked items

Ask: "Please review the execution plan and mark which items to execute now. You can move items between Part 1 and Part 2, or add/remove items."

### 6. Execute Approved Items

Once user approves the execution plan, execute only the checked items:

#### 6.1 GitHub Setup
- Create repositories
- Configure branch protection rules
- Add deploy keys and webhooks
- Set up PR templates and issue templates

#### 6.2 Cloud Infrastructure Setup
- **AWS Setup:** Configure IAM roles, create S3 buckets, set up VPC (with user-provided credentials)
- **EC2 Setup:** Launch and configure instances
- **RunPod Setup:** Configure GPU pods (if applicable)

#### 6.3 CI/CD Pipeline Setup
- Validate workflow syntax
- Configure GitHub Actions secrets
- Test pipeline execution

#### 6.4 Container & Server Setup
- Validate Dockerfile builds
- Test docker-compose locally
- Configure Nginx and MySQL (if applicable)

**Execution Guidelines:**
- Request user credentials/access before interacting with cloud services
- Always use Infrastructure as Code for reproducibility
- Test configurations in development environment first
- Document any manual steps that cannot be automated
- Report progress and any errors to user immediately

### 7. Update Documentation

After execution, update documentation to reflect actual results:

#### 7.1 Document Execution Results
- Record actual resource IDs, ARNs, URLs created
- Update configuration files with real values (excluding secrets)
- Document any deviations from the original plan
- Note any issues encountered and resolutions

#### 7.2 Create Operations Runbook
- Document how to access each service
- Include troubleshooting steps for common issues
- Add monitoring and alerting thresholds
- Document backup and recovery procedures

#### 7.3 Request Final Approval
- Present updated documentation to user
- Confirm all infrastructure is working as expected
- Ask: "Please verify the infrastructure setup. Let me know if any adjustments are needed."

### 8. Complete Stage

Once user confirms infrastructure is working:

#### 8.1 Prepare for Next Stage
- Summarize infrastructure setup for reference in sprint development
- Document any pending setup that requires production credentials
- List prerequisites for production deployment
- Note any manual approval gates in the pipeline

#### 8.2 Announce Completion
Inform the user:
- "Stage 08 (DevOps) is complete"
- Summary of documentation created
- Summary of infrastructure provisioned and verified
- Any pending actions or follow-up items
- "Ready to proceed to Stage 09 (Sprints) when you are"

## Role Communication

Based on the stage context and project details, pick up your roles from `dev-swarm/docs/dev-swarm-roles.md` to announce your actions before performing them using the following format:

**As a {Role} [and {Role}, ...], I will {action description}**

## Communication Pattern

This communication pattern ensures:
- **Transparency** - Users know exactly what infrastructure is being configured
- **Human-in-the-loop oversight** - Users can approve cloud resource creation and costs
- **Role clarity** - Clear understanding of which expertise is being applied
- **Traceability** - Easy to track which role made which infrastructure decisions
- **Security** - Users control access credentials and approve security configurations

Always announce your role and action before:
- Reading and analyzing documents
- Creating infrastructure configuration files
- Making cloud resource recommendations
- Requesting credentials or access
- Executing infrastructure setup commands
- Finalizing deliverables
